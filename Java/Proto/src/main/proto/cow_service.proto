
syntax = "proto3";

//if importing related proto files:
//import "other_service.proto";

// Defining the Java package where the generated code will live
option java_package = "sep3.wayofmilk.grpc";
option java_multiple_files = true;
//c# namespace
option csharp_namespace = "Sep3.WayOfMilk.Grpc";


// The service T3 will implement and T2 will call
service CowService {
  rpc GetAllCows (Empty) returns (CowList);
  rpc AddCow (CowCreationRequest) returns (CowData);
  rpc UpdateCow (CowData) returns (CowData);
  rpc GetCowById (CowIdRequest) returns (CowData);
  rpc DeleteCow (CowIdRequest) returns (Empty);
  //TODO: consider whether transfer requests should be handled here or in a separate proto/service
  rpc TransferCow (CowTransferRequest) returns (CowData);
  //since health update is allowed only by a specific type of user, a separate method is created
  rpc UpdateCowHealth (CowData) returns (CowData);
}

// The messages (equivalents of the DTOs)
message Empty {} // Simple empty message for requests with no parameters

message CowList {
  repeated CowData cows = 1; // 'repeated' means a list
}
message CowCreationRequest {
  string regNo = 1;
  string birthDate = 2; // Using string for dates, and handling conversion (LocalDate <-> string) in the service layer
  int64 registeredByUserId = 3;

}

message CowData {
  int64 id = 1;         // Corresponds to 'long' in Java (int is int32, double is float)
  // 'optional' tells gRPC to generate 'has...()' methods in Java
  //necessary for null checks in Long, Boolean and LocalDate fields especially during updates
  optional string regNo = 2;
  // Using string for dates, and handling conversion (LocalDate <-> string) in the service layer
  optional string birthDate = 3;
  optional bool isHealthy = 4;
  optional int64 departmentId = 5; //TODO: consider whether it should be a translated string instead of an id
}

message CowIdRequest {
  int64 id = 1;
}

message CowTransferRequest {
  int64 cowId = 1;
  int64 newDepartmentId = 2;
  optional bool isHealthy = 3;
}
