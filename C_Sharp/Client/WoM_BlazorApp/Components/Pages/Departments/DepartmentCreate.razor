@page "/departments/create"
@rendermode InteractiveServer

@using ApiContracts
@using WoM_BlazorApp.Services.Interfaces
@inject IDepartmentService DepartmentService
@inject NavigationManager Nav

<PageTitle>Add Department</PageTitle>

<h1>Add new department</h1>

@if (!string.IsNullOrEmpty(error))
{
    <div class="alert alert-danger">@error</div>
}

<div class="mb-3">
    <label class="form-label">Department Type</label>
    <InputSelect @bind-Value="type" class="form-control">
        @foreach (var t in Enum.GetValues<DepartmentType>())
        {
            <option value="@t">@t</option>
        }
    </InputSelect>
</div>

<div class="mb-3">
    <label class="form-label">Department Name</label>
    <InputText @bind-Value="name" class="form-control" placeholder="Department Name" />
</div>

<button class="btn btn-success" @onclick="CreateAsync">Save</button>
<button class="btn btn-secondary ms-2" @onclick="@(() => Nav.NavigateTo("/departments"))">
    Cancel
</button>

@code {
    private DepartmentType type = DepartmentType.Milking;
    private string name = string.Empty;

    private string? error;

    private async Task CreateAsync()
    {
        error = null;

        try
        {
            var dto = new CreateDepartmentDto
            {
                Type = type,
                Name = name
            };

            await DepartmentService.CreateAsync(dto);
            Nav.NavigateTo("/departments");
        }
        catch (Exception ex)
        {
            error = ex.Message;
        }
    }
}
