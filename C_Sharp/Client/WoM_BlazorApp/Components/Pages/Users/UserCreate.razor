@page "/users/create"
@rendermode InteractiveServer

@using System
@using ApiContracts
@using WoM_BlazorApp.Http
@inject IUserService UserService
@inject NavigationManager Nav

<PageTitle>Add User</PageTitle>

<h1>Add new user</h1>

<div class="mb-3">
    <label class="form-label">Name</label>
    <InputText @bind-Value="name" class="form-control" />
</div>

<div class="mb-3">
    <label class="form-label">Password</label>
    <InputText @bind-Value="password" type="password" class="form-control" />
</div>
<div class="mb-3">
    <label class="form-label">Role</label>
    <InputSelect @bind-Value="role" class="form-control">
        @foreach (UserRole r in Enum.GetValues(typeof(UserRole)))
        {
            <option value="@r">@r.ToString()</option>
        }
    </InputSelect>
</div>

@if (!string.IsNullOrEmpty(error))
{
    <p style="color:red">@error</p>
}

<button class="btn btn-success" @onclick="CreateAsync">Save</button>
<button class="btn btn-secondary ms-2" @onclick="@(() => Nav.NavigateTo("/users"))">
    Cancel
</button>

@code {
    private string name = "";
    private string email = "";
    private string password = "";
    private string phone = "";
    private string address = "";
    private UserRole role;
    private string licenseNumber;
    private string? error;


    private async Task CreateAsync()
    {
        error = null;
        try
        {
            var dto = new CreateUserDto()
            {
                Name = name,
                Email = email,
                Phone =phone,
                Password = password,
                Role = role,
                Address = address,
                LicenseNumber = licenseNumber
            };

            await UserService.CreateAsync(dto);
            Nav.NavigateTo("/users");
        }
        catch (Exception e)
        {
            error = e.Message;
        }
    }
}
